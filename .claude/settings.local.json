{
  "permissions": {
    "allow": [
      "Bash(git checkout:*)",
      "Bash(go build:*)",
      "Bash(git add:*)",
      "Bash(git commit -m \"$\\(cat <<''EOF''\nfix: Resolve critical race conditions and add thread safety\n\nThis commit addresses three critical race conditions identified in the codebase\nthat could lead to data corruption, crashes, and memory leaks.\n\n## Critical Issues Fixed\n\n### 1. Clipboard Manager Race Conditions\n- Added sync.RWMutex to protect shared state \\(previousClipboard,\n  lastTransformedClipboard, config, resolvedSecrets, diff state\\)\n- Protected all field access in ProcessClipboard with proper locking\n- Fixed goroutine access to shared state in paste/revert operations\n- Made config and secrets copies before long-running operations\n- Added panic recovery in paste goroutine and revert callback\n\n### 2. Hotkey Manager Goroutine Leaks\n- Added sync.RWMutex to protect registeredHotkeys map\n- Implemented proper goroutine lifecycle management with quit channels\n- Fixed memory leak where goroutines weren''t stopped on UnregisterAll\\(\\)\n- Added select statement with quit channel to allow clean shutdown\n- Added panic recovery in all hotkey listener goroutines\n- Properly cleanup quit channels on unregister\n\n### 3. Systray Manager Race Conditions\n- Added sync.RWMutex to protect config and profileMenuItems\n- Fixed concurrent access to config in profile toggle handlers\n- Protected UpdateConfig method with mutex\n- Added panic recovery in profile toggle and add profile handlers\n- Implemented proper lock/unlock patterns to avoid holding locks during\n  I/O operations \\(config save\\)\n\n## Additional Improvements\n\n### Panic Recovery\n- Added defer/recover in all background goroutines\n- Prevents crashes from panics in:\n  * Paste operations\n  * Hotkey listeners\n  * Revert callbacks\n  * Profile toggle handlers\n  * Add profile handlers\n\n### Thread Safety Patterns\n- Use RLock for read operations, Lock for write operations\n- Copy data structures before passing to goroutines\n- Release locks before I/O operations \\(file save, clipboard write\\)\n- Proper error handling after lock release\n\n## Documentation\n- Added comprehensive claude.md project documentation\n- Added .claudeignore for better context management\n- Documented all race conditions and fixes in commit message\n\n## Testing\n- Successfully compiled with no errors\n- All mutex locks properly paired with unlocks\n- No deadlock potential in code paths\n\nCo-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git merge:*)",
      "Bash(go doc:*)"
    ]
  }
}
